<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Server Monitoring</title>

  <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
  <link rel="stylesheet" href="stylesheets/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <script src='/socket.io/socket.io.js'></script>
  <script type="text/javascript">
    var socket = io();

    socket.connect('http://localhost', {
      'reconnection': true,
      'reconnectionDelay': 500,
      'reconnectionAttempts': 10
    });

    socket.emit('clientQuery', 'agentcpu');
    socket.on('serverSent', function(message) {

      drawChart(message);
    });
  </script>
</head>

<body>
  <div id="wrapper">
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
      <% include ./menu.ejs%>
    </div>
    <!-- Page Content -->
    <div class="page-content-wrapper">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <a href="#" class="btn btn-primary" id="menu-toggle">Menu</a>
            <!-- top  -->
            <% include ./top.ejs %>
              <p>CPU</p>
              <!--  -->
          </div>
          <div class="chart-container">
            <canvas id="myChart"></canvas>
          </div>
          <script type="text/javascript">
          function drawChart(message) {
            var result = [];
            // 2017-06-26 22
            for(var i in message) {
                var idate = message[i].idate;
                var year = idate.substr(0,4);
                var month = (Number(idate.substr(5,2)) -1 ).toString();
                var date = idate.substr(8,2);
                var hour = idate.substr(11,2);
                result.push({
                  x: new Date(year, month, date, hour),
                  y: message[i].us
                });
            }

            var ctx = $('#myChart');
            var myChart = new Chart(ctx, {
              type: 'line',
              data: {
                datasets: [{
                  backgroundColor: 'transparent', //NO COLOR UNDER LINE
                  borderColor: 'rgba(54, 162, 235, 1)',
                  data: result
                }]
              },
              options: {
                title: {
                  display: true,
                  text: 'CPU Usage'
                },
                legend: {
                  display: false
                },
                scales: {
                  xAxes: [{
                    type: 'time',
                    time: {
                      format: 'DD MMM'
                    }
                  }],
                  yAxes: [{
                    ticks: {
                      min: 0,
                      max: 100,
                      beginAtZero: true
                    }
                  }]
                }
              }
            });
          }
          </script>
          <!-- middle -->
          <!--  -->
        </div>

        <!-- bottom -->
        <!--  -->
      </div>
    </div>

  </div>
  <script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script>
  <script src="javascripts/index.js"></script>
  <script src="javascripts/timezone.js"></script>

</body>

</html>
